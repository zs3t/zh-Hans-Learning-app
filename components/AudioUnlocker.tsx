// app/components/AudioUnlocker.tsx

'use client'; // å‘Šè¯‰ Next.js è¿™æ˜¯ä¸€ä¸ªå®¢æˆ·ç«¯ç»„ä»¶

import { useEffect, useState } from 'react';

// è¿™ä¸ªç»„ä»¶ä¸æ¸²æŸ“ä»»ä½•å¯è§çš„ UIï¼Œåªè´Ÿè´£å¤„ç†éŸ³é¢‘è§£é”é€»è¾‘
const AudioUnlocker = () => {
  const [isUnlocked, setIsUnlocked] = useState(false);

  useEffect(() => {
    // å®šä¹‰è§£é”å‡½æ•°
    const unlockAudio = () => {
      // å¦‚æœå·²ç»è§£é”ï¼Œç›´æ¥è¿”å›ï¼Œé¿å…é‡å¤æ‰§è¡Œ
      if (isUnlocked) return;

      // åˆ›å»ºä¸€ä¸ªæçŸ­çš„ã€æ— å£°çš„éŸ³é¢‘
      const sound = new Audio('data:audio/mpeg;base64,SUQzBAAAAAABEVRYWFgAAAAtAAADY29tbWVudABCaWdTb3VuZEJhbmsuY29tIC8gTGFTb25vdGhlcXVlLm9yZwBURU5DAAAAHQAAA1N3aXRjaCBQbHVzIMKpIE5DSCBTb2Z0d2FyZQBUSVQyAAAABgAAAzIyMzUAVFNTRQAAAA8AAANMYXZmNTcuODMuMTAwAAAAAAAAAAAAAAD/80DEAAAAA0gAAAAATEFNRTMuMTAwVVVVVVVVVVVVVUxBTUUzLjEwMFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVAVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVTAAAAAAD/80DECQAAAAAQQAAATEFNRTMuMTAwVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVUFVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVVV');

      // æ’­æ”¾å®ƒï¼Œè¿™ä¼šè·å¾—æµè§ˆå™¨çš„éŸ³é¢‘è®¸å¯
      sound.play().then(() => {
        // æˆåŠŸåç«‹å³æš‚åœï¼Œç”¨æˆ·ä¸ä¼šå¬åˆ°ä»»ä½•å£°éŸ³
        sound.pause();
        sound.currentTime = 0;
        console.log('ğŸ”Š Audio context unlocked on iOS');
        setIsUnlocked(true); // æ›´æ–°çŠ¶æ€ï¼Œå¹¶ç§»é™¤ç›‘å¬å™¨
      }).catch(error => {
        // åœ¨ç”¨æˆ·äº¤äº’ä¸­è°ƒç”¨ï¼Œè¿™é‡Œé€šå¸¸ä¸ä¼šæŠ¥é”™
        console.error('Audio unlock failed:', error);
      });
    };

    const cleanup = () => {
      window.removeEventListener('click', unlockAudio);
      window.removeEventListener('touchstart', unlockAudio);
    };

    // å¦‚æœå°šæœªè§£é”ï¼Œåˆ™æ·»åŠ äº‹ä»¶ç›‘å¬å™¨æ¥æ•è·ç¬¬ä¸€æ¬¡ç”¨æˆ·äº¤äº’
    if (!isUnlocked) {
      window.addEventListener('click', unlockAudio);
      window.addEventListener('touchstart', unlockAudio);
    } else {
      cleanup(); // å¦‚æœå·²ç»è§£é”ï¼Œç¡®ä¿æ—§çš„ç›‘å¬å™¨è¢«æ¸…ç†
    }

    // ç»„ä»¶å¸è½½æ—¶ï¼Œæ¸…ç†äº‹ä»¶ç›‘å¬å™¨
    return cleanup;
  }, [isUnlocked]); // ä¾èµ– isUnlockedï¼Œå½“å®ƒæ”¹å˜æ—¶é‡æ–°è¿è¡Œ effect

  return null; // è¿™ä¸ªç»„ä»¶æ˜¯æ— å½¢çš„
};

export default AudioUnlocker;

